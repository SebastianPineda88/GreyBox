<?php
// Home page
// Sebastian Pineda
// Week 8: Introduction to PHP


$name = "Sebastian Pineda";
$title = "Index Page";
$file = "index.php";
$date = "Oct 27, 2025";
$description = "Index Page";
$banner = "Week 8: Introduction to PHP";

include("./includes/header.php");
include_once("./includes/functions.php");

$conn = db_connect();
prepare_statements($conn); 


echo "<div class='container mt-4'>
        <h1>{$title}</h1>
        <p> {$name}</p>
        <p> {$banner}</p>
      </div>";


$sql = "
    SELECT s.student_id, u.first_name, u.last_name, s.program_code
    FROM students s
    JOIN users u ON s.user_id = u.user_id
    ORDER BY u.last_name ASC
";


@pg_query($conn, "DEALLOCATE get_students");


pg_prepare($conn, "get_students", $sql);
$result = pg_execute($conn, "get_students", array());


if ($result) {
    echo "<div class='container mt-4'>
            <table class='table table-striped'>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Program</th>
                    </tr>
                </thead>
                <tbody>";

    while ($row = pg_fetch_assoc($result)) {
        echo "<tr>
                <td>{$row['student_id']}</td>
                <td>{$row['first_name']}</td>
                <td>{$row['last_name']}</td>
                <td>{$row['program_code']}</td>
              </tr>";
    }

    echo "</tbody></table></div>";
} else {
    echo "<p style='color:red;'>Error: Could not retrieve students data.</p>";
}

include("./includes/footer.php");


ob_end_flush();
?>
